# Chapter 05: 파일 접근 권한 관리
## 00. 개요
- 리눅스는 기본적으로 여러 사용자와 함께 사용하므로 자신의 파일이나 디렉토리를 보호할 필요가 있다.
- 2장에서 배운 `ls` 명령으로 파일의 상세 정보를 확인할 수 있었는데, 이에 파일에 대한 접근 권한도 포함되어 있다.
- 이 파일 접근 권한을 제어하는 방법을 알아보자.

## 01. 파일 속성
- 이눅스와 같은 다중 사용자 시스템은 개인의 파일 보호를 위해 사용자의 파일을 접근할 수 없도록 보안 기능을 제공한다.
- 접근 권한은 파일이 가지고 있는 속성 중 하나다.
- 파일을 관리하는데 사용하는 속성에는 어떤 것이 있는지 알아보고, 이후에 파일의 접근 권한에 대해 구체적으로 알아보자.
- `ls -l`을 통해 파일 속성을 확인할 수 있다.
```
utrm@myubuntu:~$ ls -l /etc/hosts
-rw-r--r-- 1 root root 223 Mar 12 07:34 /etc/hosts
```

|번호|속성 값|의미|
|:---:|:---:|:---|
|1|`-`|파일의 종류 (`-`: 일반 파일, `d`: 디렉토리)|
|2|`rw-r--r--`|파일을 읽고 쓰고 실행할 수 있는 접근 권한 표시|
|3|`1`|하드 링크의 개수|
|4|`root`|파일 소유자의 로그인 ID|
|5|`root`|파일이 속한 그룹 이름|
|6|`223`|파일의 크기 (바이트 단위)|
|7|`Mar 12 07:34`|파일이 마지막으로 수정된 날짜|
|8|`/etc/hosts`|파일명|

### 파일의 종류
- `-`: 일반 파일
- `d`: 디렉토리
- 이외의 다른 종류의 파일을 나타내는 문자도 정의되어 있다.
- 파일의 종류를 알려주는 명령어는 `file`이 있다.
- 형식: `file [파일명]`
```
utrm@myubuntu:~$ file /etc/hosts /usr/bin
/etc/hosts: ASCII text
/usr/bin:   directory
```

### 파일의 접근 권한 표시
- 파일 소유자와 그룹이나 기타 사용자들이 파일에 대해 가지고 있는 접근 권한을 표시하는 것
- 파일 소유자가 `chmod` 명령을 통해 바꿀 수 있다.

### 하드링크의 개수
- 하드 링크는 한 파일에 대해 여러 개의 파일명을 가질 수 있도록 하는 기능이다.

### 파일 소유자의 로그인 ID
- 리눅스 모든 파일은 소유자가 있다.
- 시스템 관련 파일들은 대부분 루트 계정이 소유자이다.
- 일반 파일은 해당 파일을 생성한 사용자가 소유자이다.

### 파일이 속한 그룹 이름
- 리눅스에서 사용자는 기본적으로 하나 이상의 그룹에 속해 있다.
- `ls -l` 명령어로 출력된 그룹명은 파일이 속한 그룹의 이름이다.
- 이 그룹에 속한 사용자들에게 권한을 부여하여 파일을 공유할 수 있다.
- 사용자가 속한 기본 그룹은 시스템 관리자가 사용자를 등록할 때 결정한다.
- 사용자가 임의로 자신의 그룹을 바꿀 수 없으며 반드시 시스템 관리자에게 변경을 요청해야 한다.
- 그룹이 정의된 파일은 `/etc/group`으로 시스템 관리자만 수정할 수 있다.
- 사용자가 속한 그룹을 알려주는 명령은 `groups` 이다.
- 형식: `groups [사용자명]`
```
utrm@myubuntu:~$ groups
utrm adm cdrom sudo dip plugdev lxd
utrm@myubuntu:~$ groups utrm
utrm : utrm adm cdrom sudo dip plugdev lxd
utrm@myubuntu:~$ groups root
root : root
```

### 파일의 크기
- 파일의 크기를 바이트 단위로 알려준다.

### 파일이 마지막으로 수정된 날짜
- 파일이 마지막으로 수정된 날짜와 시간이 표시된다.
- 연도가 표시되지 않으면 올해를 의미한다.

## 02. 파일 접근 권한
- 접근 권한은 해당 파일을 읽고 쓰고 실행할 수 있는 권한으로 사용자의 파일을 보호하는 가장 기본적인 기능이라고 할 수 있다.
- 리눅스는 사용자를 파일 소유자, 파일이 속한 그룹, 그 외 기타 사용자라는 세 카테고리로 구분한다.
- 사용자가 파일을 생성하면 그 파일의 소유자가 되는데, 일반적으로 사용자가 속한 기본 그룹이 파일과 관련된 그룹이 된다.
- 만약 상위 디렉토리에 특수한 권한이 부여되어 있으면 다른 그룹으로 지정될 수도 있다.
- 파일의 소속 그룹은 시스템 관리자가 명령을 이용하여 강제로 변경할 수도 있다.
- 사용자 카테고리 별로 접근 권한을 다르게 부여하여 파일을 보호할 수 있다.
- 카테고리별로 파일에 접근하는 권한을 소유자나 시스템 관리자가 조정할 수 있다.

### 접근 권한 종류
- 읽기 권한, 쓰기 권한, 실행 권한 세가지로 분류된다.
- 읽기 권한: 파일을 변경할 수는 없지만 내용을 볼 수 있는 권한
- 쓰기 권한: 파일의 내용을 보는 것 뿐만 아니라 수정하거나 삭제하는 것도 가능한 권한

|권한|파일|디렉토리|
|:---:|:---:|:---:|
|읽기|파일을 읽거나 복사할 수 있다.|`ls` 명령으로 디레고리 목록을 볼 수 있다. (`ls` 명령의 옵션은 실행 권한이 있어야 사용할 수 있다.)|
|쓰기|파일을 수정, 이동, 삭제할 수 있다. (디렉토리에 쓰기 권한이 있어야 한다.)|파일을 생성하거나 삭제할 수 있다.|
|실행|파일을 실행할 수 있다. (셸 스크립트나 실행 파일의 경우)|`cd`명령을 사용할 수 있다. 파일을 디렉토리로 이동하거나 복사할 수 있다.|

### 접근 권한 표기 방법
- 접근 권한의 표기는 사용자 카테고리별로 누가 파일을 읽고 쓰고 실행할 수 있는지를 문자로 표현한 것이다.
- `r`: 읽기 권한
- `w`: 쓰기 권한
- `x`: 실행 권한
- `-`: 해당 권한이 없는 경우
- 사용자 카테고리별로 세가지 권한의 부여 여부를 아홉 개의 문자로 표기한다.
- `-rw-r--r--`: 
    - 맨 앞의 `-`는 파일의 종류를 나타내는 부분으로 접근 권한과 관계가 없다.
    - 소유자: `rw-`
    - 그룹: `r--`
    - 기타 사용자: `r--`
- 다양한 접근 권한 조합의 예시

|접근 권한|의미|
|:---:|:---:|
|`rwxr-xr-x`|소유자는 읽기, 쓰기, 실행 권한을 모두 가지고 그룹과 기타 사용자는 읽기, 실행 권한을 가진다.|
|`r-xr-xr-x`|소유자, 그룹, 기타 사용자 모두 읽기, 실행 권한을 가진다.|
|`rw-------`|소유자만 읽기, 쓰기 권한을 가지고, 그룹과 기타 사용자는 아무 권한이 없다.|
|`rw-rw-rw-`|소유자, 그룹, 기타 사용자 모두 읽기, 쓰기 권한을 가진다.|
|`rwxrwxrwx`|소유자, 그룹, 기타 사용자 모두 읽기, 쓰기, 실행 권한을 가진다.|
|`rwx------`|소유자만 읽기, 쓰기, 실행 권한을 가지고, 그룹과 기타 사용자는 아무 권한이 없다.|
|`r--------`|소유자만 읽기 권한을 가지고, 그룹과 기타 사용자는 아무 권한이 없다.|

### 접근 권한 변경 명령
- `chmod`: 파일 소유자와 시스템 관리자가 접근 권한을 바꾸는 명령어
- 형식: `chmod [옵션] 권한 파일(디렉토리)`
- 옵션: `-R`: 하위 디렉토리까지 모두 변경할 수 있다.
- 기호 모드: 접근 권한을 변경하기 위해 문자와 기호를 사용하여 권한을 표시한다.
- 숫자 모드: 접근 권한을 변경하기 위해 숫자를 사용한다.

## 03. 기호를 이용한 파일 접근 권한 변경
- 기호 모드는 사용자 카테고리 문자, 연산자 기호, 접근 권한 문자로 구성된다.
- 사용자 카테고리: 소유자, 그룹, 기타 사용자를 나타내는 문자로 표기
- 연산자: 권한 부여나 제거를 나타내는 기호
- 접근 권한 문자: 읽기, 쓰기, 실행을 나타내는 문자

|문자/기호|구분|의미|
|:---:|:---:|:---:|
|`u`|사용자 카테고리 문자|파일 소유자|
|`g`|사용자 카테고리 문자|파일 소유 그룹|
|`o`|사용자 카테고리 문자|소유자와 그룹 이외의 기타 사용자|
|`a`|사용자 카테고리 문자|전체 사용자|
|`+`|연산자 기호|권한 부여|
|`-`|연산자 기호|권한 제거|
|`=`|연산자 기호|접근 권한 설정|
|`r`|접근 권한 문자|읽기 권한|
|`w`|접근 권한 문자|쓰기 권한|
|`x`|접근 권한 문자|실행 권한|

- 기호 모드를 사용한 접근 권한 설정의 예

|권한 표기|의미|
|:---:|:---:|
|`u+w`|소유자에게 쓰기 권한 부여|
|`u-x`|소유자의 실행 권한 제거|
|`g+w`|그룹에 쓰기 권한 부여|
|`o-r`|기타 사용자의 읽기 권한 제거|
|`g+wx`|그룹에 쓰기와 실행 권한 부여|
|`+wx`|모든 사용자에게 쓰기와 실행 권한 부여|
|`a+rwx`|모든 사용자에게 읽기와 쓰기와 실행 권한 부여|
|`u=rwx`|소유자에게 읽기와 쓰기와 실행 권한 부여|
|`go+w`|그룹과 기타 사용자에게 쓰기 권한 부여|
|`u+x,go+w`|소유자에게 실행 권한을 부여하고 그룹과 기타 사용자에게 쓰기 권한 부여|

- 권한 제거 예시
```
utrm@myubuntu:~$ mkdir linux_ex/ch5
utrm@myubuntu:~$ cd linux_ex/ch5
utrm@myubuntu:~/linux_ex/ch5$ cp /etc/hosts test.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-rw-r--r-- 1 utrm utrm 223 Mar 17 06:52 test.txt
utrm@myubuntu:~/linux_ex/ch5$ chmod u-w test.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-r--r--r-- 1 utrm utrm 223 Mar 17 06:52 test.txt
```
- 추가적인 실습
```
utrm@myubuntu:~/linux_ex/ch5$ chmod g+wx test.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-r--rwxr-- 1 utrm utrm 223 Mar 17 06:52 test.txt

utrm@myubuntu:~/linux_ex/ch5$ chmod o+x test.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-r--rwxr-x 1 utrm utrm 223 Mar 17 06:52 test.txt

utrm@myubuntu:~/linux_ex/ch5$ chmod go-x test.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-r--rw-r-- 1 utrm utrm 223 Mar 17 06:52 test.txt

utrm@myubuntu:~/linux_ex/ch5$ chmod a+x test.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-r-xrwxr-x 1 utrm utrm 223 Mar 17 06:52 test.txt

utrm@myubuntu:~/linux_ex/ch5$ chmod u+w,g-w test.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-rwxr-xr-x 1 utrm utrm 223 Mar 17 06:52 test.txt
```

## 04. 숫자를 이용한 파일 접근 권한 변경
- 소유자, 그룹, 기타 사용자 별로 권한을 부여하거나 제거할 때는 기호 모드가 편리하지만 전체적으로 권한을 조정할 때는 문자의 조합이 복잡해진다.
- 이럴 때 숫자 모드로 `chmod` 명령을 사용하면 소유자, 그룹, 기타 사용자 권한을 한번에 원하는 대로 변경할 수 있다.

### 숫자로 환산하는 방법
- 숫자 모드에서는 각 권한이 있고 없고를 1과 0으로 표기하고 이를 다시 환산하여 숫자로 표현한다.
- 카테고리 별로 권한의 조합에 때라 0~7로 나타내는 것이다.
- 따라서 [소유자 권한][그룹 권한][기타 사용자 권한] 이 [0~7][0~7][0~7] 로 표현된다.
- 이진수로 1, 0, 1로 표현한 후 이를 다시 십진수로 변환하여 4로 표기하는 방식이다.
- 접근 권한과 숫자의 대응 관계

|접근 권한|환산|숫자|의미|
|:---:|:---:|:---:|:---:|
|`rwx`|111 -> 4+2+1|7|읽기, 쓰기, 실행|
|`rw-`|110 -> 4+2+0|6|읽기, 쓰기|
|`r-x`|101 -> 4+0+1|5|읽기, 실행|
|`r--`|100 -> 4+0+0|4|읽기|
|`-wx`|011 -> 0+2+1|3|쓰기, 실행|
|`-w-`|010 -> 0+2+0|2|쓰기|
|`--x`|001 -> 0+0+1|1|실행|
|`---`|000 -> 0+0+0|0|권한이 없음|

- 전체 접근 권한을 숫자로 표기한 예

|접근 권한|숫자 모드|
|:---:|:---:|
|`rwxrwxrwx`|777|
|`rwxr-xr-x`|755|
|`rw-rw-rw-`|666|
|`r-xr-xr-x`|555|

### 숫자 모드를 이용한 접근 권한 변경
- 형식: `chmod [숫자 모드] 파일명`
```
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-rw-r--r-- 1 utrm utrm 223 Mar 17 06:52 test.txt

utrm@myubuntu:~/linux_ex/ch5$ chmod 444 test.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-r--r--r-- 1 utrm utrm 223 Mar 17 06:52 test.txt

utrm@myubuntu:~/linux_ex/ch5$ chmod 474 test.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 4
-r--rwxr-- 1 utrm utrm 223 Mar 17 06:52 test.txt
```

## 05. 기본 접근 권한 설정
- 리눅스에서 파일이나 디렉토리를 생성할 때 기본 접근 권한이 자동으로 설정된다.
- 일반 파일:
    - 소유자: 읽기, 쓰기 권한
    - 그룹: 읽기, 쓰기 권한
    - 기타 사용자: 읽기 권한
- 디렉토리:
    - 소유자: 읽기, 쓰기, 실행 권한
    - 그룹: 읽기, 쓰기, 실행 권한
    - 기타 사용자: 읽기, 실행 권한
```
utrm@myubuntu:~/linux_ex/ch5$ touch han.txt
utrm@myubuntu:~/linux_ex/ch5$ mkdir temp
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 8
-rw-rw-r-- 1 utrm utrm    0 Mar 17 07:35 han.txt
drwxrwxr-x 1 utrm utrm 4096 Mar 17 07:35 temp
-r--rwxr-- 1 utrm utrm  223 Mar 17 06:52 test.txt
```

### 기본 접근 권한 확인 및 변경
- `umask`: 기본 접근 권한을 확인하고 설정하는 명령
- 형식: `umask [옵션] [마스크 값]`
- 옵션: `-S`: 마스크 값을 문자로 출력한다.
- 아무 인자 없이 사용하면 현재 설정된 기본 마스크 값을 보여준다.
- `0002`: 맨 앞의 0은 다른 용도이며, 기본 접근 권한을 `002`로 적용한다.
```
utrm@myubuntu:~/linux_ex/ch5$ umask
0002
```

#### 1. 마스크 값의 의미
- 마스크 값: 파일이나 디렉토리 생성 시 부여하지 않을 권한을 지정해놓는 것을 의미한다.
- `0002`를 예로 들면 `--------w-`인 것이다.
- 이는 기타 사용자에게 쓰기 권한을 부여하지 **않겠**다는 의미이다.
```
utrm@myubuntu:~/linux_ex/ch5$ umask -S
u=rwx, g=rwx, o=rx
```

#### 2. 마스크 값 변경하기
- `umask` 명령으로 마스크 값을 변경한다.
- `umask`로 마스크 값을 변경하면 파일이나 디렉토리를 생성할 때 적용되는 기본 접근 권한도 바뀐다.
```
utrm@myubuntu:~/linux_ex/ch5$ umask 077
utrm@myubuntu:~/linux_ex/ch5$ umask
0077

utrm@myubuntu:~/linux_ex/ch5$ touch linux.txt
utrm@myubuntu:~/linux_ex/ch5$ ls -l
total 8
-rw-rw-r-- 1 utrm utrm    0 Mar 17 07:35 han.txt
-rw------- 1 utrm utrm    0 Mar 17 07:47 linux.txt
drwxrwxr-x 1 utrm utrm 4096 Mar 17 07:35 temp
-r--rwxr-- 1 utrm utrm  223 Mar 17 06:52 test.txt
```

### 마스크 값의 적용 과정
- 마스크 값은 파일이 생성될 때마다 적용된다.
- 마스크 값을 비트로 표시했을 때 그 값이 1인 경우 대응하는 권한은 제외한다.
- 아래는 마스크 값이 적용되는 진리표인다.

||||||
|:---:|:---:|:---:|:---:|:---:|
|요청 권한|1|1|0|0|
|마스크|1|0|1|0|
|부여된 권한|0|1|0|0|

- 마스크 값이 1이면 요청 권한이 1인지 0인지 상관없이 부여되는 권한은 0이 된다.
- 마스크 값이 0이면 요청 권한이 그대로 부여된다.

#### 1. 마스크 값 계산 방법
- 쉽게 이해하는 방법으로는 최대 접근 권한에서 마스크 값을 빼는 것이다.
- 예를 들어 `002` 인 경우, 접근 권한은 `-------w-`이다.
- 최대 접근 권한인 `rw-rw-rw-`에서 빼면 기본 접근 권한은 `rw-rw-r--`이다.
- 숫자로도 `666` 에서 `002` 를 빼면 `664`이다.

#### 2. 여러 가지 마스크 값
- 마스크 값의 의미

|마스크 값|일반 파일|디렉토리|의미|
|:---:|:---:|:---:|:---:|
|`002`|`664`|`755`|그룹과 기타 사용자는 읽기만 가능하다.|
|`077`|`600`|`700`|그룹과 기타 사용자의 접근 권한을 전부 삭제한다.|
|`027`|`640`|`750`|그룹은 읽기와 실행만 가능하고 기타 사용자의 접근 권한을 전부 삭제한다.|

## 06. 특수 접근 권한 설정
- 특수 접근 권한: 일반적인 접근 권한 외에 특별한 접근 권한
```
utrm@myubuntu:~/linux_ex/ch5$ umask
0002
```
- 위의 예시에서 세자리의 접근 권한이 아니라 네자리가 출력되는 이유가 특수 접근 권한 때문이다.
- 일반 접근 권한: 앞자리가 `0`
- 특수 접근 권한: 앞자리가 `1`, `2`, `4`
    - `4`: SetUID
    - `2`: SetGID
    - `1`: 스티키 비트

### SetUID
- SetUID가 설정된 파일을 실행하면 해당 파일이 실행되는 동안에는 파일을 실행한 사용자의 권한이 아니라 파일 소유자의 권한이 적용된다.
```
utrm@myubuntu:~/linux_ex/ch5$ touch set.exe
utrm@myubuntu:~/linux_ex/ch5$ chmod 755 set.exe
utrm@myubuntu:~/linux_ex/ch5$ ls -l set.exe
-rwxr-xr-x 1 utrm utrm 0 March 17 08:06 set.exe
```
- SetUID는 접근 권한에서 맨 앞자리에 `4`를 설정해야 한다.
```
utrm@myubuntu:~/linux_ex/ch5$ chmod 4755 set.exe
utrm@myubuntu:~/linux_ex/ch5$ ls -l set.exe
-rwsr-xr-x 1 utrm utrm 0 March 17 08:06 set.exe
```
- SetUID를 설정하게 되면 소유자의 실행 권한이 `x`가 아닌 `s`가 된다.
- 이는 `set.exe`를 실행하면 항상 `utrm`의 권한을 갖는다는 의미이다.
- 기본적으로 `passwd`에는 SetUID가 설정되어 있다.
```
utrm@myubuntu:~/linux_ex/ch5$ ls -l /usr/bin/passwd
-rwsr-xr-x 1 root root 72056 May 30 2024 /usr/bin/passwd
```

### SetGID
- SetUID와 거의 동일하다.
- SetGID가 설정된 파일을 실행하면 해당 파일이 실행되는 동안에는 파일 소유 그룹의 권한으로 실행한다.
- SetGID는 접근 권한에서 맨 앞자리에 `2`를 설정해야 한다.
- SetGID를 설정하면 그룹의 실행 권한에 `x`가 아닌 `s`가 표시된다.
```
utrm@myubuntu:~/linux_ex/ch5$ chmod 2755 set.exe
utrm@myubuntu:~/linux_ex/ch5$ ls -l set.exe
-rwxr-sr-x 1 utrm utrm 0 March 17 08:06 set.exe
```

### 스티키 비트
- 스티키 비트는 디렉토리에 설정하며, 디렉토리에 스티키 비트가 설정되어 있으면 이 디렉토리에는 누구나 파일을 생성할 수 있다.
- 파일은 파일을 생성한 계정으로 소유자가 설정되고, 다른 사용자가 생성한 파일은 삭제할 수 없다.
- `/tmp` 디렉토리는 스티키 비트가 설정되어 있다.
- 스티키 비트가 설정된 디렉토리는 기타 사용자 실행 권한에 `x`가 아닌 `t`가 표시된다.
```
utrm@myubuntu:~/linux_ex/ch5$ ls -ld /tmp
drwxrwxrwt 19 root root 4096 Mar 17 08:06 /tmp

utrm@myubuntu:~/linux_ex/ch5$ chmod 1755 temp
utrm@myubuntu:~/linux_ex/ch5$ ls -ld temp
drwxr-xr-t 2 utrm utrm 4096 Mar 17 07:35 temp
```