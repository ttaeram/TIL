# Chapter 03: 문서 편집
## 00. 개요
- 자신이 원하는 내용으로 파일을 만드는 방법에 대한 학습을 진행한다.
- GUI에서 제공하는 gedit을 사용해도 되지만 터미널 환경에서 수정하는 방법에 대한 학습
- vim: 리눅스의 대표적인 문서 편집기
- 유닉스에서 제공하는 편집기인 vi를 업그레이드한 것이다.

## 01. 리눅스의 문서 편집기
### 리눅스의 편집기 종류
- GUI 환경인 그놈에서는 gedit로 메모장처럼 간단하게 문서를 작성할 수 있다.
- 리눅스가 나오기 전 유닉스에서 사용하던 행 편집기(라인 편집기)와 화면 편집기가 있다.

|구분|종류|
|:---:|:---:|
|행 단위 편집기|ed, ex, sed|
|화면 단위 편집기|vi, emacs(이맥스)|
|GUI 편집기|gedit|

1. ed
- ed는 유닉스 초기의 행 편집기로, 현재는 많이 사용하지 않고, 우부투에서 `ed` 명령을 유지하고 있다.

2. ex
- ex는 단독으로 사용하기보다는 vi에 연결하여 vi를 강화하는 기능을 제공한다.

3. sed
- sed는 스트림 편집기로, 지시된 명령에 따라 파일 내용을 일괄적으로 바꿔 출력한다.
- 셸 스크립트 작성 시 파일을 읽어 편집하는 기능에 주로 사용된다.

4. vi
- vi는 리눅스에서 일반적으로 사용되는 화면 편집기이다.
- ex 편집기를 바탕으로 제작되었으며 명령이 단순하고 빠르게 편집이 가능하다.

5. emacs
- emacs는 제공하는 기능이 다양하지만 어렵고 복잡하다.
- 화면 단위 이맥스 편집기 중에서 GNU 이맥스가 유명하다.

### 모드형과 비모드형 편집기
- 모드형: 입력 모드와 명령 모드가 구분되어 있다.
- 비모드형: 두 모드가 구분되어 있지 않다.
- 입력 모드: 텍스트를 입력할 수 있는 모드
- 명령 모드: 텍스트를 수정, 삭제, 복사, 붙이기 등을 편집하는 모드
- 예를 들어 한글, 워드는 비모드형 편집기이다.
- 쉽게 말해 모드의 전환 버튼이 필요하면 모드형, 모드의 전환이 불필요하면 비모드형 편집기인 것.

## 02. vi 사용법
### vi 동작 모드
- 앞서 말한 두 모드 외에 마지막 행 모드가 있다.
- 마지막 행 모드에서 사용하는 명령은 ex 편집기의 명령이라고 생각하면 편하다.
- vi를 처음 가동하면 명령 모드로 시작을 한다.
- `i, I, a, A, o, O` 를 입력하면 입력 모드로 전환되며, 다시 돌아갈 때는 `esc` 버튼을 누르면 된다.
- 검색이나 바꾸기 같은 특별한 명령을 수행하려면 마지막 행 모드로 가야 한다.
- `:, /, ?` 를 입력하면 마지막 행 모드로 전환되며, 명령을 실행하려면 `Enter` 버튼을 입력해야 하고, 다시 명령 모드로 돌아가려면 `esc` 버튼을 입력하면 된다.

### vi 시작과 종료
1. vi 시작하기
- 파일을 지정하거나 지정하지 않고 시작할 수 있다.
- vi를 시작할 때 파일을 지정하지 않으면 마지막 행 모드에서 파일명을 정할 수 있다.
```
utrm@myubuntu:~/linux_ex/ch3$ vi test.txt
utrm@myubuntu:~/linux_ex/ch3$ vi
```

2. vi 파일 저장하고 종료하기
- `Shift + zz`: 명령 모드에서 파일의 저장과 종료를 동시에 수행할 수 있는 명령키

|명령키|모드|기능|
|:---:|:---:|:---:|
|`:q`|마지막 행 모드|vi에서 작업한 것이 없을 때 그냥 종료한다.|
|`:q!`|마지막 행 모드|작업한 내용을 저장하지 않고 종료한다.|
|`:w 파일명`|마지막 행 모드|직업한 내용을 저장만 한다. 파일명을 지정하면 다른 파일로 저장한다.|
|`:wq`, `:wq!`|마지막 행 모드|작업한 내용을 저장하고, vi를 종료한다.|
|`ZZ`(`Shift + zz`)|명령 모드|직업한 내용을 저장하고, vi를 종료한다.|

### vi 모드 전환
|명령키|기능|
|:---:|:---:|
|`i`|현재 커서 자리에 입력한다.|
|`a`|현재 커서 다음 자리에 입력한다.|
|`o`|커서가 위치한 행의 다음 행에 입력한다.|
|`I`|커서가 위치한 행의 첫 칼럼으로 이동하여 입력한다.|
|`A`|커서가 위치한 행의 마지막 칼럼으로 이동하여 입력한다.|
|`O`|커서가 위치한 행의 이전 행에 입력한다.|

1. `i` 명령키를 사용해 입력 모드로 전환하기
```
utrm@myubuntu:~/linux_ex/ch3$ vi test.txt
```
```
ubuntu linux study
I like linux
~
~
~
```
- `i` 명령을 입력한 뒤 내용을 입력 후 `esc`를 입력 시 커서가 x 위로 이동한다.

2. `i`와 `a` 명령키 차이
- 커서가 x 위에 있는 상태에서 `i` 입력 후 `spacebar`ubuntu를 입력하면 x 이전에 ubuntu가 입력된다.
- 이후 `esc` 입력 시 u 위에 커서가 놓인다.
```
ubuntu linux study
I like linu ubuntux
~
~
~
```
- `a` 입력 후 `spacebar`linu 를 입력하면 u 다음에 글자가 입력된다.
- 이후 `esc` 입력 시 u 위에 커서가 놓인다.
```
ubuntu linux study
I like linu ubuntu linux
~
~
~
```

3. `o` 명령키를 사용하여 입력 모드로 전환하기
- 현재 커서가 위치한 후 다음 행에 글자를 입력하려면 `o`를 입력하여 입력 모드에 진입한다.
```
ubuntu linux study
I like linu ubuntu linux

~
~
```

### 커서와 화면 이동
- vi에서 커서를 옮기고 싶을 경우 마우스가 아닌 키보드로 해야 한다.

1. 커서 이동하기

|명령키|기능|
|:---:|:---:|
|`k`/`j`|커서를 한 행 위/아래로 이동한다.|
|`l`/`h`|커서를 한 글자 오른쪽/왼쪽으로 이동한다.|
|`^` 또는 `0`/`$`|커서를 현재 행의 처음/마지막으로 이동한다.|
|`-`/`+` 또는 `Enter`|커서를 앞/다음 행의 처음으로 이동한다.|
|`H`/`M`/`L`|커서를 화면의 맨 위/중간/맨 아래 행으로 이동한다.|
|`w`/`e`|커서를 다음 단어의 처음/마지막 글자로 이동한다.|
|`b`|커서를 앞 단어의 첫 글자로 이동한다.|

- 위 유닉스 vi 명령키에 해당하는 명령이 리눅스 vim에서는 방향키로도 사용 가능한 부분이 존재한다.

|명령키|방향키|
|:---:|:---:|
|`k`|위 방향키|
|`j`|아래 방향키|
|`l`|오른쪽 방향키|
|`h`|왼쪽 방향키|
|`^` 또는 `0`|`Home`|
|`$`|`End`|

2. 화면 이동하기

|기존 명령키|기능|추가 명령키|
|:---:|:---:|:---:|
|`^u`(`ctrl + u`)|반 화면 위로 이동한다.|-|
|`^d`(`ctrl + d`)|반 화면 아래로 이동한다.|-|
|`^b`(`ctrl + b`)|한 화면 위로 이동한다.|`Page Up`|
|`^f`(`ctrl + f`)|한 화면 아래로 이동한다.|`Page Down`|
|`^y`(`ctrl + y`)|화면을 한 행만 위로 이동한다.|-|
|`^e`(`ctrl + e`)|화면을 한 행만 아래로 이동한다.|-|

3. 특정 행으로 바로 이동하기

|명령키|기능|
|:---:|:---:|
|`G`|파일의 마지막 행으로 커서가 이동한다.|
|`행 번호 + G`|지정한 행 번호로 커서가 이동한다.|
|`:행 번호`|지정한 행 번호로 커서가 이동한다. (마지막 행 모드)|
|`:$`|파일의 마지막 행으로 커서가 이동한다. (마지막 행 모드)|

### 내용 수정

|명령키|기능|
|:---:|:---:|
|`r`|커서가 위치한 글자를 다른 글자로 수정한다.|
|`cw`, `#cw`|커서 위치부터 현대 단어의 끝까지 수정한다. #에는 수정할 단어의 수를 지정한다. (ex: `3cw`는 커서 위치부터 세 단어를 수정한다.)|
|`s`, `#s`|커서 위치부터 `esc`를 입력할 때까지 수정한다. #에는 수정할 글자의 수를 지정한다. (ex: `5s`는 커서 위치부터 5글자를 수정한다.)|
|`cc`|커서가 위치한 행의 내용을 모두 수정한다.|
|`C`|커서 위치부터 행의 끝까지 수정한다.|

### 내용 삭제

|명령키|기능|
|:---:|:---:|
|`x`, `#x`|커서 위치의 글자를 삭제한다. #에는 삭제할 글자 수를 지정한다.|
|`dw`, `#dw`|커서 위치의 단어를 삭제한다. #에는 삭제할 글자 수를 지정한다.|
|`dd`, `#dd`|커서 위치의 행을 삭제한다. #에는 삭제할 행의 수를 지정한다.|
|`D`|커서 위치부터 행의 끝까지 삭제한다.|

### 명령 취소

|명령키|기능|
|:---:|:---:|
|`u`|명령을 취소한다.|
|`U`|해당 행에서 한 모든 명령을 취소한다.|
|`:e!`|마지막으로 저장한 내용 이후의 것을 버리고 새로 작업한다.|

### 복사 및 잘라 붙이기
1. 복사하기, 잘라내기, 붙이기

|명령키|기능|
|:---:|:---:|
|`yy`, `#yy`|커서가 위치한 행을 복사한다. #에는 복사할 행의 수를 지정한다.|
|`p`|커서가 위치한 행의 아래쪽에 붙인다.|
|`P`|커서가 위치한 행의 위쪽에 붙인다.|
|`dd`, `#dd`|커서가 위치한 행을 잘라둔다. 삭제와 같은 기능이다. #에는 잘라둘 행의 수를 지정한다.|

2. 네임드 버퍼 사용하기
- 복사하거나 잘라낸 내용이 버퍼에 저장된다.
- 언네임드 버퍼: 이름을 붙이지 않은 버퍼
- 언네임드 버퍼에는 내용을 하나만 저장할 수 있다.
- 네임드 버퍼: 이름을 붙여 사용할 수 있는 버퍼
- 네임드 버퍼에 이름을 붙일 때는 `"+문자` 또는 `"+숫자`의 형태롤 사용한다.
- 네임드 버퍼: `"a`, `"b`, ...
- 숫자 버퍼: `"1`, `"2`, ...
- 네임드 버퍼에 커서가 위치한 행을 저장하려면 `버퍼 이름 + yy`를 입력한다.

3. 마지막 행 모드에서 복사하기, 잘라내기, 붙이기
- 범위 지정 명령키

|명령키|기능|
|:---:|:---:|
|`1,$` 또는 `%`|1행부터 마지막 행까지 지정한다.|
|`1,.`|1행부터 커서가 있는 행까지 지정한다.|
|`.,$`|커서가 있는 행부터 마지막 행까지 지정한다.|
|`,-3`|현재 행과 이전 세 행까지 (총 네 행)을 지정한다.|
|`10,20`|10행부터 20행까지 지정한다.|

- 복사하기, 잘라내기, 붙이기

|명령키|기능|
|:---:|:---:|
|`:#y`|#로 지정한 행을 복사한다. (ex: `3y`는 세번째 행을 복사한다.)|
|`:<범위>y`|범위로 지정한 행을 복사한다. (ex: `2,4y`는 2~4 행을 복사한다.)|
|`:#d`|#로 지정한 행을 잘라낸다. (ex: `3d`는 세번째 행을 잘라낸다.)|
|`:<범위>d`|범위로 지정한 행을 잘라낸다. (ex: `1,4d`는 1~4 행을 잘라낸다.)|
|`:pu`|현재 행 다음에 버퍼의 내용을 붙인다.|
|`:#pu`|#로 지정한 행 다음에 버퍼의 내용을 붙인다. (ex: `4pu`와 같이 지정한다.)|

### 검색 및 바꾸기
- 특정 문자열을 검색하거나 검색한 문자열을 다른 문자열로 바꾸는 명령은 마지막 행 모드에서 제공한다.

1. 검색하기
- 검색을 위한 마지막 행 모드로 진입하려면 `/`이나 `?`을 입력한다.
- `/`: 커서의 위치에서 아래 방향으로 검색
- `?`: 커서의 위치에서 위 방향으로 검색

|명령키|기능|
|:---:|:---:|
|`/문자열`|문자열을 아래 방향으로 검색한다.|
|`?문자열`|문자열을 위 방향을 검색한다.|
|`n`|원래 찾던 방향으로 다음 문자열을 검색한다.|
|`N`|역방향으로 다음 문자열을 검색한다.|

2. 바꾸기
- 문자열을 바꾸려면 `:`를 입력하여 마지막 행 모드에 진입한다.

|명령키|기능|
|:---:|:---:|
|`:s/문자열1/문자열2/`|커서가 위치한 행에서 첫번째로 나오는 문자열1을 문자열2로 바꾼다.|
|`:%s/문자열1/문자열2/g`|파일 전체에서 모든 문자열1을 문자열2로 바꾼다.|
|`:<범위>s/문자열1/문자열2/`|범위 내 모든 각 행에서 첫번째로 나오는 문자열1을 찾아 문자열2로 바꾼다.|
|`:<범위>s/문자열1/문자열2/g`|범위 내 모든 행에서 문자열1을 문자열2로 바꾼다.|
|`:<범위>s/문자열1/문자열2/gc`|범위 내 모든 행에서 문자열1을 문자열2로 바꿀 때 수정할지 여부를 묻는다.|

### 기타 유용한 명령키
1. 파일 읽어오기, 여러 파일 편집하기

|명령키|기능|
|:---:|:---:|
|`:r 파일`|지정한 파일을 읽어들여 현재 커서 위치에 삽입한다,|
|`:e 파일`|지정한 파일로 전환한다. (기존 파일을 `:w`로 저장한 뒤에 실행해야 한다.)|
|`:n`|vi 시작 시 여러 파일을 지정했을 경우 다음 파일로 작업을 이동한다.|

2. vi에서 셀 명령 사용하기

|명령키|기능|
|:---:|:---:|
|`:! 셸 명령`|vi 작업을 잠시 중단하고 셸 명령을 실행한다. (vi로 돌아오려면 `Enter`를 누른다.)|
|`:sh`|vi를 잠시 빠져나가서 셸 명령을 실행한다. (vi로 돌아오려면 `exit` 명령을 입력한다.)|

3. 기타 명령키

|명령키|기능|
|:---:|:---:|
|`ctrl + l`|현재 화면을 다시 출력한다.|
|`ctrl + g`|현재 커서 위치의 행 번호를 마지막 행에 출력한다.|
|`Shift + j`|현재 행과 아래 행을 연결하여 한 행으로 만든다.|
|`.`|바로 직전에 했던 명령을 반복한다.|
|`~`|커서 위치의 글자를 대문자나 소문자로 바꾼다.|

## 03. vi 환경 설정
- `set`: 사용자가 vi 환경을 설정할수 있도록 하는 명령

|`set` 명령과 옵션|기능|
|:---:|:---:|
|`set nu`|파일 내용의 각 행에 행 번호를 표시한다 (보이기만 할 뿐 저장은 불가)|
|`set nonu`|행 번호를 감춘다.|
|`set list`|눈에 보이지 않는 특수 문자를 표시한다.|
|`set nolist`|특수문자를 감춘다.|
|`set showmode`|현재 모드를 표시한다.|
|`set noshowmode`|현재 모드를 감춘다.|
|`set`|`set`으로 설정한 모든 vi 환경 설정 값을 출력한다.|
|`set all`|모든 vi 환경 변수와 현재 값을 출력한다.|