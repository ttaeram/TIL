# Chapter 04: 셸 사용법
## 00. 개요
- 셸은 리눅스 커널과 사용자를 연결하는 중요한 역할을 수행한다.
- 리눅스 기본 셸로 제공되는 배시셸은 유닉스 전통 셸인 본셸과 호환성을 유지하면서도 편리한 기능을 제공한다.

## 01. 셸의 기능과 종류
### 셸의 기능
- 셸이 제공하는 기능은 크게 명령어 해석기 기능, 프로그래밍 기능, 사용자 환경 설정 기능 등으로 분류된다.

#### 1. 명령어 해석기 기능
- 가장 기본적인 기능으로, 사용자와 커널 사이에서 명령을 해석하여 전달하는 해석기와 번역기 기능이다.
- 사용자가 로그인하면 셸이 자동으로 실행되어 사용자가 명령을 입력하기를 기다린다.
- 로그인 셸: 로그인할 때 실행되는 셸. `/etc/passwd` 파일에 사용자별로 지정되어 있다.
- 프롬프트: 셸이 사용자의 명령을 기다리고 있음을 나타내는 표시
- 셸은 대기 상태로 있다가 사용자가 입력한 명령이나 스크립트를 받아들여 이 명령이 셸 자체의 내장 명령인지 판단한다.
- 내장 명령일 시, 바로 실행된다.
- 아닐 시, 별도의 명령 파일이 존재하고, 자식 프로세스를 만들어 이 프로세스가 명령 파일을 실행하게 한다.
- 이 동안 부모인 셸은 대기 상태가 되고, 자식 프로세스가 종료되면 대기 상태가 해제되어 다시 프롬프트를 출력한다.

#### 2. 프로그래밍 기능
- 셸의 프로그래밍 기능을 이용하면 여러 명령을 사용하여 반복적으로 수행하는 작업을 하나의 프로그램으로 만들 수 있다.
- 이러한 셸 프로그램을 셸 스크립트라고 부른다.

#### 3. 사용자 환경 설정 기능
- 셸은 사용자 환경을 설정할 수 있도록 초기화 파일 기능을 제공한다.
- 초기화 파일에는 명령을 찾아오는 경로를 설정하거나, 파일과 디렉토리를 새로 생성할 때 적용하는 기본 권한을 설정하거나, 다양한 환경 변수 등을 설정할 수 있다.
- 사용자가 로그인할 때 이 초기화 파일이 실행되어 사용자별로 초기 환경이 설정된다.

### 셸의 종류
- 유닉스 지원 주요 셸: 본셸, C셸, 콘셸, 배시셸
- 앨리어스 설정, 초기화 파일, 스크립트를 작성하는 문법 등에 차이들이 존재한다.

#### 본셸
- 최초의 셸로, 유닉스 V7에 처음 등장했다.
- 단순하고 처리 속도가 빨라 많이 사용되었고, 지금도 시스템 관리 작업을 수행하는 많은 셸 스크립트는 본셸은 기반으로 한다.
- 본 셸의 명령 이름은 `sh`이다.
- 현재 사용되는 본셸은 콘셸이나 배시셸로 심볼릭 링크되어 있는 경우가 많다.

#### C셸
- 2BSD 유닋스에 포함되어 발표되었다.
- 본셸에 없던 앨리어스나 히스토리같은 사용자 편의 기능을 포함하고 있다.
- 셸 스크립트 작성으 위한 구문 형식이 C 언어와 같아 C셸이라는 이름이 붙었다.
- C셸의 명령 이름은 `csh`이다.
- C셸ㄹ은 다양한 사용자 편의 기능을 구현하기 위해 크기가 커진데다 처리 속도가 느리다는 단점이 있다.

#### 콘셸
- 유닉스 SVR 4에 포함되어 발표되었다.
- 본셀과 호환성을 유지하면서 히스토리, 앨리어스 기능 등 C셸의 특징도 모두 제공하면서 처리 속도도 빠르다는 장점이 있다.
- 콘셸의 명령 이름은 `ksh`이다.
- 우분투에서는 기본으로 설치되어 있지 않아 별도의 설치가 필요하다.

#### 배시셸
- 본셸과의 호환성을 유지하면서 C셸, 콘셸의 편리한 기능도 포함하고 있다.
- 배시셸의 명령 이름은 `bash`이다.
- 리눅스의 기본 셸로 제공되고 있다.
- 우분투에서는 사용자 계정의 기본 셸로 배시셸을 사용 중이다.

#### 대시셸
- 본셸을 기반으로 개발된 셸로써, 포직스(POSIX) 표준을 준수하면서 작은 크기로 개발되었다.
- 우분투 6.10 버전부터 본셸 대신 사용하고 있다.
- 부팅 시 셸 스크립트 실행이 빠르고 파일 크기가 작으며 신뢰성이 높다.

## 02. 셸 기본 사용법
### 셸 지정 및 변경

|프롬프트 모양|셸 종류|
|:---:|:---:|
|`$`|본셸, 콘셸, 배시셸|
|`%`|C셸|

- 시스템에 저장되어 있는 사용자 정보를 확인하면 현재 사용 중인 셸을 알 수 있다.
```
utrm@myubuntu:~$ grep utrm /etc/passwd
utrm:x:1000:1000:utrm,,,:/home/utrm:/bin/bash
```

#### 1. 기본 셸 변경하기: `chsh`
- 사용하고자 하는 셸이 리눅스에 설치되어 있다면 기본 셸로 변경 가능하다.
- 형식: `chsh [옵션] [사용자명]`
- 옵션:
    - `-s shell`: 지정하는 셸 (절대 경로)로 로그인 셸을 바꾼다.
    - `-l`: `/etc/chells` 파일에 지정된 셸을 출력한다.

```
utrm@myubuntu:~$ cat /etc/shells
# /etc/shells: valid login shells
/bin/sh
/bin/bash
/usr/bin/bash
/bin/rbash
/usr/bin/rbash
/user/bin/sh
/bin/dash
/usr/bin/dash
```

#### 2. 로그인 셸과 서브 셸
- 서브 셸: 사용자가 프롬프트에서 생성한 다른 셸
- 서브 셸은 또다른 서브 셸을 생성할 수 있다.

### 셸 내장 명령
- 셸은 자체적으로 내장 명령을 가지고 있다.
- 셸 명령은 별도의 실행 파일이 없이 셸 안에 포함되어 있다.
- 대표적인 셸 내장 명령은 `cd`이다.

### 출력 명령
- `echo` 명령
- 형식: `echo [-n] [문자열]`
- 옵션: `-n`: 마지막에 줄바꿈을 하지 않는다.
```
utrm@myubuntu:~$ echo linux
linux
utrm@myubuntu:~$ echo "linux ubuntu"
linux ubuntu
```

- `printf` 명령
- 형식: `printf [형식] [인수]`
- 옵션: 형식: `%d`, `\n`등 C언어의 `printf` 함수의 형식을 지정한다.
```
utrm@myubuntu:~$ printf linux
linuxutrm@myubuntu:~$ printf "linux ubuntu \n"
linux ubuntu
utrm@myubuntu:~$ printf "%d + %d = %d\n" 10 10 20
10 + 10 = 20
```

### 특수문자 사용 방법
#### 1. 특수문자 `*`

|사용 예|의미|
|:---:|:---:|
|`ls *`|현재 디렉토리의 모든 파일과 서브 디렉토리를 나열한다. 서브 디렉토리의 내용도 출력한다.|
|`cp * /tmp`|현재 디렉토리의 모든 파일을 `/tmp` 디렉토리 아래로 복사한다.|
|`ls -F t*`|`t`, `tmp`, `temp`와 같이 파일명이 t로 시작하는 모든 파일의 이름과 파일 종류를 출력한다. t도 해당한다는데 주의한다.|
|`cp *.txt ../ch3`|확장자가 `txt`인 모든 파일을 상위 디렉토리 아래의 `ch3` 디렉토리로 복사한다.|
|`ls -l h*d`|파일명이 h로 시작하고 d로 끝나는 모든 파일의 상세 정보를 출력한다. `hd`, `had`, `hard`, `h12345d` 등 이 조건에 맞는 모든 파일의 정보를 볼 수 있다.|

#### 2. 특수문자 `?`와 `[]`

|사용 예|의미|
|:---:|:---:|
|`ls t?.txt`|t 다음에 임의의 한 문자가 오고 파일의 확장자가 `txt`인 모든 파일의 이름을 출력한다. `t1.txt`, `t2.txt`, `ta.txt` 등이 해당된다. 단, `t.txt`는 제외한다.|
|`ls -l tmp[135].txt`|tmp 다음에 1, 3, 5 중에 하나가 오고 파일의 확장자가 `txt`인 모든 파일의 이름을 출력한다. `tmp1.txt`, `tmp3.txt`, `tmp5.txt` 파일이 있으면 해당 파일의 상세 정보를 출력한다. 단 `tmp.txt`는 제외한다.|
|`ls -l tmp[1-3].txt`|[1-3]은 1부터 3까지의 범위를 의미한다. 따라서 `ls -l tmp[123].txt`와 결과가 같다.|
|`ls [0-9]*`|파일명이 숫자로 시작하는 모든 하일의 목록을 출력한다.|
|`ls [A-Za-z]*[0-9]`|파일명이 영문자로 시작하고 숫자로 끝나는 모든 파일의 목록을 출력한다.|

#### 3. 특수문자 `~`와 `-`

|사용 예|의미|
|:---:|:---:|
|`cp *.txt ~/ch3`|확장자가 `txt`안 모든 파일을 현재 작업 중인 사용자의 홈 디렉토리 아래 `tmp` 디렉토리로 복사한다.| 
|`cp ~user2/linux.txt .`|`user2`라는 사용자의 홈 디렉토리 아래에서 `linux.txt` 파일을 찾아 현재 디렉토리로 복사한다.|
|`cd -`|이전 작업 디렉토리로 이동한다.|

#### 4. 특수문자 `;`과 `|`

|사용 예|의미|
|:---:|:---:|
|`date ; ls ; pwd`|왼쪽부터 차례대로 명령을 실행한다. 즉, 날짜를 출력한 후 현재 디렉토리의 파일 목록을 출력하고, 마지막으로 현재 작업 디렉토리의 절대 경로를 보여준다.|
|`ls -al / ㅣ more`|루트 디렉토리에 있는 모든 파일의 상세 정보를 한 화면씩 출력한다. `ls -al /` 명령의 결과가 `more` 명령의 입력으로 전달되어 페이지 단위로 출력되는 것이다.|

#### 5. 특수문자 `''`와 `""`

|사용 예|의미|
|:---:|:---:|
|`echo '$SHELL'`|`$SHELL` 문자열이 화면에 출력된다.|
|`echo "$SHELL"`|셸 환경 변수의 SHELL에 저장된 값인 현재 셸의 종류가 화면에 출력된다. `/bin/bash`를 예로 들 수 있다.|

#### 6. 특수문자 ``

|사용 예|의미|
|:---:|:---:|
|`echo "Today is 'date'"`|`'date'`가 명령으로 해석되어 `date` 명령의 실행 결과로 바뀐다. 결과적으로 다음과 같이 출력된다. `Today is 2021.12.12.(일) 15:42:40 KST`|
|`ls /user/bin/'uname -m'`|`uname -m` 명령의 실행 결과를 문자열로 바꿔 파일 이름으로 사용한다.|

#### 7. 특수문자 `\`

|사용 예|의미|
|:---:|:---:|
|`ls -l t\*`|`t*`라는 이름을 가진 파일의 상세 정보를 출력한다.|
|`echo \$SHELL`|`$SHELL`을 화면에 출력한다. `echo '$SHELL'`과 결과가 같다.|

#### 8. 특수문자 `>`, `<`, `>>`

|사용 예|의미|
|:---:|:---:|
|`ls -l > res`|`ls -l` 명령의 실행 결과를 화면이 아닌 `res` 파일에 저장한다.|
|`ls -l >> res`|`ls -l` 명령의 결과를 `res` 파일 끝 부분에 추가한다.|
|`cat < text`|`cat` 명령의 입력을 `text` 파일에서 받는다.|

## 03. 입출력 방향 변경
- 명령의 실행 결과를 파일로 저장하는 방법
- 입력을 파일에서 읽어오는 방법

### 표준 입출력 장치
- 표준 입력 장치: 리눅스에서 셸이 작업을 수행하는데 필요한 정보를 받아들이는 장치 (키보드)
- 표준 출력 장치: 실행 결과를 내보내는 장치 (화면)
- 표준 오류 장치: 표준 출력과 별도로 오류 메시지를 내보내는 장치 (화면)
- 파일 디스크럽터: 셸이 작업 중 필요한 파일에 붙인 일련번호

|파일 디스크럽터|파일 디스크럽터 대신 사용하는 이름|정의|
|:---:|:---:|:---:|
|0|`stdin`|명령의 표준 입력|
|1|`stdout`|명령의 표준 출력|
|2|`stderr`|명령의 표준 오류|

### 출력 리다이렉션
- 출력의 방향을 바꾸는 것으로 두가지 방법이 있다.
- 두 방법의 차이는 출력 결과를 저장할 파일이 이미 존재하는 경우, 기존 파일의 내용을 유지할지 여부이다.

#### 1. 파일 덮어쓰기: `>`
- 형식: 
    - `명령 1 > 파일명`: 파일 디스크럽터 상 1은 화면을 말하는 것
    - `명령 > 파일명`
```
utrm@myubuntu:~$ mkdir linux_ex/ch4
utrm@myubuntu:~$ cd linux_ex/ch4
utrm@myubuntu:~/linux_ex/ch4$ ls out1
ls: 'out1'에 접근할 수 없습니다: 그런 파일이나 디렉토리가 없습니다.
utrm@myubuntu:~/linux_ex/ch4$ ls -al
합계 8
...
utrm@myubuntu:~/linux_ex/ch4$ ls -al > out1
utrm@myubuntu:~/linux_ex/ch4$ cat out1
합계 8
...
utrm@myubuntu:~/linux_ex/ch4$ date > out1
utrm@myubuntu:~/linux_ex/ch4$ cat out1
2021. 12. 12. (일) 15:45:45 KST
```

#### 2. 파일에 내용 추가하기: `>>`
- 형식: `명령 >> 파일명`
- 없는 파일이면 생성하고, 있는 파일이면 파일의 끝에 명령의 결과를 추가한다.
```
utrm@myubuntu:~/linux_ex/ch4$ cat out1
Ubuntu Linux
I love Linux.
utrm@myubuntu:~/linux_ex/ch4$ date >> out1
utrm@myubuntu:~/linux_ex/ch4$ cat out1
Ubuntu Linux
I love Linux.
2021. 12. 12. (일) 15:45:45 KST
```

### 오류 리다이렉션
- 명령의 실행 결과를 파일로 저장되게 했다고 해서 오류 메시지가 파일로 저장되지 않고 화면에 출력된다.
- 같은 것처럼 보이지만 다르게 관리되고 있다.
- 오류 메시지를 파일에 저장하는 방법: `2>`
- 형식: `명령 2> 파일명`
```
utrm@myubuntu:~/linux_ex/ch4$ ls /abc 2> ls.err
utrm@myubuntu:~/linux_ex/ch4$ cat ls.err
ls: '/abc'에 접근할 수 없습니다: 그런 파일이나 디렉토리가 없습니다.
```

#### 1. 표준 출력과 표준 오류를 한번에 리다이렉션하기
```
utrm@myubuntu:~/linux_ex/ch4$ ls . /abc > ls.out 2> ls.err
```

#### 2. 오류 메시지 버리기
```
utrm@myubuntu:~/linux_ex/ch4$ ls /abc 2> /dev/null
```

#### 3. 표준 출력과 표준 오류를 한 파일로 리다이렉션하기
```
utrm@myubuntu:~/linux_ex/ch4$ ls . /abc > ls.out 2>&1
utrm@myubuntu:~/linux_ex/ch4$ cat ls.out
ls: '/abc'에 접근할 수 없습니다: 그런 파일이나 디렉토리가 없습니다
.:
ls.err
ls.out
out1
```

### 입력 리다이렉션: `<`
- 형식:
    - `명령 0< 파일명`
    - `명령 < 파일명`
- `cat` 명령은 파일의 내용이나 키보드 입력을 출력하는 것인데, 파일의 내용을 출력하는 것은 `<`가 생략된 것이였다.

## 04. 배시셸 환경 설정
- 셸은 셸의 환경을 설정하기 위한 값을 저장할 수 있도록 변수를 제공한다.
- 이 변수애는 사용자 정보, 명령을 찾아오는 경로, 각 사용자의 프롬프트 모양 등 드양한 정보가 저장되어 있어 사용자의 작업 환경을 더욱 편리하게 설정할 수 있도록 한다.

### 셸 변수와 환경 변수
- 셸이 사용하는 변수에는 셸 변수와 환경 변수가 있다.
- 셸 변수는 현재 셸에서만 사용할 수 있고 서브 셸로는 전달되지 않는다.
- 환경 변수는 현재 셸 뿐만 아니라 서브 셸로도 전달된다.
- 쉽게 말해 셸 변수는 지역 변수, 환경 변수는 전역 변수이다.

## 05. 앨리어스와 히스토리

## 06. 프롬프트 설정

## 07. 환경 설정 파일