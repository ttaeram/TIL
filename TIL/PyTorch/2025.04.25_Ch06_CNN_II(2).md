# Chapter 06: 합성곱 신경망 2
## 3. 이미지 분할을 위한 신경망
- 이미지 분할(image segmentation): 신경망을 훈련시켜 이미지를 픽셀 단위로 분할하는 것
-  즉, 이미지를 픽셀 단위로 분할하여 이미지에 포함된 객체를 추출한다.
- 이미지 분할의 대표적 네트워크: 완전 합성곱 네트워크, 합성곱 & 역합성곱 네트워크, U-Net, PSPNet, DeepLabv3/DeepLabv3+
- 먼저 완전 합성곱 네트워크를 살펴본다.

### 3-1. 완전 합성곱 네트워크
- 완전연결층의 한계는 고정된 크기의 입력만 받아들이며, 완전연결층을 거친 후에는 위치 정보가 사라진다는 것이다.
- 이러한 문제를 해결하기 위해 완전연결층을 1×1 합성곱으로 대체하는 것이 완전 합성곱 네트워크이다.
- 즉, 완전 합성곱 네트워크(Fully Convolutional Network, FCN)는 이미지 분류에서 우수한 성능을 보인 CNN 기반 모델(AlexNet, VGG16, GoogLeNet)을 변형시켜 이미지 분할에 적합하도록 만든 네트워크이다.
- 예를 들어 그림과 같이 AlexNet 아래쪽에서 사용되었던 완전연결층 세 개를 1×1 합성곱으로 변환하면 위치 정보가 남아 있기 때문에 히트맵(heatmap) 그림과 같이 고양이의 위치를 확인할 수 있다.

![](./assets/Ch06-3/Deeplearning01.jpg)

- 또한, 합성곱층으로 사용되기 때문에 입력 이미지에 대한 크기 제약이 사라지는 장점이 있다.

### 3-2. 합성곱 & 역합성곱 네트워크
- 완전 합성곱 네트워크는 위치 정보가 보존된다는 장점에도 아래 단점이 있다.
    - 여러 단계의 합성곱층과 풀링층을 거치면서 해상도가 낮아진다.
    - 낮아진 해상도를 복원하기 위해 업 샘플링 방식을 사용하기 때문에 이미지의 세부 정보들을 잃어버리는 문제가 발생한다.
- 이러한 문제를 해결하기 위해 역합성곱 네트워크를 도입한 것이 합성곱 & 역합성곱 네트워크(convolutional & deconvolutional network)이다.
- 역합성곱은 CNN의 최종 출력 결과를 원래의 입력 이미지와 같은 크기로 만들고 싶을 때 사용한다.
- 시멘틱 분할(semantic segmentation) 등에 활용할 수 있으며, 역합성곱을 업 샘플링(upsampling) 이라고도 한다.

![](./assets/Ch06-3/Deeplearning02.jpg)

- CNN에서 합성곱층은 합성곱을 사용하여 특성 맵 크기를 줄인다.
- 하지만 역합성곱은 이와 반대로 특성 맵 크기를 증가시키는 방식으로 동작한다.
- 역합성곱 동작 방식:
    1. 각각의 픽셀 주위에 제로 패딩(zero-padding)을 추가한다.
    2. 이렇게 패딩된 것에 합성곱 연산을 수행한다.
- 그림에서 아래쪽의 파란색 픽셀이 입력이며, 초록색 픽셀이 출력이다.
- 이 파란색 픽셀 주위로 흰색 제로 패딩을 수행하고, 회색 필터로 합성곱 연산을 수행하면 초록색이 출력된다.

![](./assets/Ch06-3/Deeplearning03.jpg)
