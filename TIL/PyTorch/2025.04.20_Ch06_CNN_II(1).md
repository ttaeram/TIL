# Chapter 06: 합성곱 신경망 2
## 01. 이미지 분류를 위한 신경망
### 1-1. LeNet-5
- LeNet-5는 합성곱 신경망이라는 개념을 최초로 얀 르쿤(Yann LeCun)이 개발한 구조이다.
- 1995년 얀 르쿤, 레옹 보토(Leon Bottu), 요슈아 벤지오(Yosua Bengio), 패트릭 하프너(Patrick Haffner)가 수표에 쓴 손글씨 숫자를 인식하는 딥러닝 구조 LeNet-5를 발표했는데, 그것이 현재 CNN의 초석이 되었다.
- LeNet-5는 합성곱(convolutional)과 다운 샘플링(sub-sampling)(혹은 풀링)을 반복적으로 거치면서 마지막에 완전연결층에서 분류를 수행한다.
- 다음 그림을 이용하여 구체적으로 살펴보면 C1에서 5×5 합성곱 연산 후 28×28 크기의 특성 맵(feature map) 여섯 개를 생성한다.
- S2에서 다운 샘플링하여 특성 맵 크기를 14×14로 줄인다.
- 다시 C3에서 5×5 합성곱 연산하여 10×10 크기의 특성 맵 16개를 생성하고, S4에서 다운 샘플링하여 특성 맵 크기를 5×5로 줄인다.
- C5에서 5×5 합성곱 연산하여 1×1 크기의 특성 맵 120개를 생성하고, 마지막으로 F6에서 완전연결층으로 C5의 결과를 유닛(unit)(또는 노드) 84개에 연결시킨다.
- 이때 C로 시작하는 것은 합성곱층을 의미하고, S로 시작하는 것은 풀링층을 의미하며, F로 시작하는 것은 완전연결층을 의미한다.

![](./assets/Ch06/Deeplearning01.jpg)

- LeNet-5를 사용하는 예제를 구현한다.
- 개와 고양이 데이터셋을 사용한다.
- 구현할 신경망:

![](./assets/Ch06/Deeplearning02.jpg)

- 32×32 크기의 이미지에 합성곱층과 최대 풀링층이 쌍으로 두 번 적용된 후 완전연결층을 거쳐 이미지가 분류되는 신경망이다.
- 신경망에 대한 설명:

|계층 유형|특성 맵|크기|커널 크기|스트라이드|활성화 함수|
|:---:|:---:|:---:|:---:|:---:|:---:|
|이미지|1|32x32|-|-|-|
|합성곱층|6|28x28|5x5|1|렐루(ReLU)|
|최대 풀링층|6|14x14|2x2|2|-|
|합성곱층|16|10x10|5x5|1|렐루(ReLU)|
|최대 풀링층|16|5x5|2x2|2|-|
|완전 연결층|-|120|-|-|렐루(ReLU)|
|완전 연결층|-|84|-|-|렐루(ReLU)|
|완전 연결층|-|2|-|-|소프트맥스(softmax)|

- 예제를 진행하기 위해 아나콘다 프롬프트에서 tqdm 라이브러리를 설치한다.
- 라이브러리는 두 가지 방법으로 설치할 수 있다.
```
pip install --user tqdm
```
```
conda install -c conda-forge tqdm
```
- 설치되었다면 라이브러리를 호출한다.
```py
# 6-1. 필요한 라이브러리 호출

import torch
import torchvision
from torch.utils.data import DataLoader, Dataset
# 이미지 변환(전처리) 기능을 제공하는 라이브러리
from torchvision import transforms
from torch.autograd import Variable
# 경사 하강법을 이용하여 가중치를 구하기 위한 옵티마이저 라이브러리
from torch import optim
import torch.nn as nn
import torch.nn.functional as F
# 파일 경로에 대한 함수들을 제공
import os
import cv2
from PIL import Image
# 진행 상황을 가시적으로 표현해 주는데, 특히 모델의 학습 경과를 확인하고 싶을 때 사용하는 라이브러리
from tqdm import tqdm_notebook as tqdm
import random
from matplotlib import pyplot as plt

# 파이토치는 텐서플로와 다르게 GPU를 자동으로 할당해 주지 않기 때문에 GPU 할당을 모델과 데이터에 선언해 주어야 함. 단 이 장에서는 CPU를 사용
device = torch.device("cuda:0" if torch.cuda.is_available() else "cpu")
```