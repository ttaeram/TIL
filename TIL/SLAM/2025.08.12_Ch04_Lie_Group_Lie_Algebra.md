# Chapter 04: 리 군과 리 대수
## 01. 리 군과 리 대수의 기초
3차원 회전 행렬이 특수 직교 군 $SO(3)$ 를 구성하고, 변환 행렬이 특수 유클리드 군 $SE(3)$ 을 구성한다.

```math
SO(3) = \{ R \in \mathbb{R}^{3 \times 3} | RR^T = I, \det(R) = 1 \}
```
```math
SE(3) = \left\{T = \begin{bmatrix} R & t \\
0^T & 1 \end{bmatrix} \in \mathbb{R}^{4 \times 4} | R \in SO(3), t \in \mathbb{R}^3 \right\}
```

회전 행렬과 변환 행렬 둘 다 덧셈 연산에 닫혀 있지 않다. 즉, 두 개의 회전 병렬 $R_1, R_2$ 의 경우 두 행렬을 더해서 얻어진 행렬은 정의에 따라 더 이상 회전 행렬이 아니다.

```math
R_1 + R_2 \notin SO(3), \ T_1 + T_2 \notin SE(3)
```

또한 두 행렬에 잘 정의된 덧셈 연산자가 없거나 일반적인 행렬 덧셈 연산은 두 집합에 닫혀 있지 않다. 곱셈 연산은 두 집합에서 유일하게 닫힌 연산이다.

```math
R_1R_2 \in SO(3), \ T_1T_2 \in SE(3)
```

행렬 곱셈이 회전 또는 변환의 복합에 해당한다는 것을 알고 있으며, 두 회전 행렬을 곱하면 두 번 회전이 수행된다. 잘 정의된 연산이 하나만 있는 집합의 경우 이를 군 또는 그룹이라고 한다.

### 1-1. 군 (그룹)
군 (그룹, Group) 은 집합과 연산의 대수 구조이다. 집합을 $A$ 로, 연산을 $\cdot$ 로 표시하면 군을 $G = (A, \cdot)$ 로 기록할 수 있다. 이는 아래의 조건을 충족해야 한다.

1. 닫힘: $\forall a_1, a_2 \in A, a_1 \cdot a_2 \in A$

2. 결합법칙: $\forall a_1, a_2, a_3 \in A, (a_1 \cdot a_2) \cdot a_3 = a_1 \cdot (a_2 \cdot a_3)$

3. 항등원: $\exists a_0 \in A, s.t. \forall a \in A, a_0 \cdot a = a \cdot a_0 = a$

4. 역원: $\forall a \in A, \exists a^{-1} \in A, s.t. a \cdot a^{-1} = a_0$

회전 행렬 집합과 행렬 곱셈이 군을 구성하고 변환 행렬과 행렬 곱셈이 군을 구성한다는 것을 확인할 수 있다. 다른 일반적인 군에는 정수의 합 $(\mathbb{Z}, +), 0$ 을 제거한 후의 유리수의 곱 $(\mathbb{Q}  0, \cdot)$ 등이 포함된다.

행렬에서 흔히 볼 수 있는 군은 아래와 같다.

- 일반 선열 군 $GL(n)$: 행렬 곱 연산을 사용하는 $n \times n$ 의 가역 행렬

- 특수 직교 군 $SO(n)$: 또는 $SO(2)$ 및 $SO(3)$ 가 가장 일반적인 회전 행렬 군

- 특수 유클리드 군 $SE(n)$: 또는 $SE(2)$ 및 $SE(3)$ 와 같이 앞서 언급한 $n$ 차원 유클리드 변환

군 구조는 군의 연산에 매우 우수한 속성을 갖도록 보장하며 군 이론은 군의 다양한 구조와 특성을 연구하는 이론이다. 리 군은 연속적인 속성을 가진 군을 말한다. 정수 군 $\mathbb{Z}$ 와 같이 이산 군은 연속 속성이 없으므로 리 군에 속하지 않는다. 우리가 강체가 공간에서 지속해 움직일 수 있다고 직관적으로 상상할 수 있으므로 모두 리 군이라고 할 수 있다.

### 1-2. 리 대수의 소개
임의의 회전 행렬 $R$ 을 고려할 때 아래 조건을 충족한다.

```math
RR^T = I
```

여기서 $R$은 카메라의 회전이며, 시간이 지남에 따라 지속해 변경된다. 즉 시간이 함수는 $R(t)$ 이고, 여전히 회전 행렬이기 때문에, 아래의 식으로 쓸 수 있다.

```math
R(t)R(t)^T = I
```

방정식의 양쪽을 시간으로 미분하면 아래 방정식을 얻는다.

```math
\dot{R}(t)R(t)^T + R(t)\dot{R}(t)^T = 0
```

두번째 항을 오른쪽으로 이항하고, 전치 관계를 사용하여 행렬을 교환하여 정리하면 아래와 같다.

```math
\dot{R}(t)R(t)^T = - \left(R(t)\dot{R}(t)^T \right)^T
```

$R(t)\dot{R}(t)^T$ 는 skew-symmetric 행렬이다. 임의의 skew-symmetric 행렬에 해당하는 고유한 벡터를 찾을 수 있다. 이 연산을 기호 $\lor$ 로 표시한다.

```math
a^{\land} = A = \begin{bmatrix}0 & -a_3 & a_2 \\
a_3 & 0 & -a_1 \\
-a_2 & a_1 & 0 \end{bmatrix}, A^{\lor} = a
```

따라서 $R(t)\dot{R}(t)^T$ 는 skew-symmetric 행렬이므로 $\phi(t) \in \mathbb{R}^3$ 에 해당하는 3차원 벡터를 찾을 수 있따.

```math
R(t)\dot{R}(t)^T = \phi(t)^{\land}
```

식의 양쪽에 $R(t)$ 를 곱하면 $R$ 이 직교 향렬이기 때문에 아래와 같은 식이 가능하다.

```math
\dot{R}(t) = \phi(t)^{\land}R(t) = \begin{bmatrix}0  & -\phi_3 & \phi_2 \\
\phi_3 & 0 & -\phi_1 \\
-\phi_2 & \phi_1 & 0 \end{bmatrix} R(t)
```

회전 행렬의 미분을 구하려면 왼쪽에 $\phi(t)^{\land}$ 행렬을 곱하면 된다. $t_0 = 0$ 을 고려할 때 회전 행렬 $R(0) = I$ 로 설정한다. 미분 정의에 따라 $R(t)$ 을 $t = t_0$ 근처에서 1차 태일러 확장으로 수행할 수 있다.

```math
R(t) \approx R(t_0) + \dot{R}(t_0)(t - t_0) \\
= I + \phi(t_0)^{\land}(t)
```

우리는 $\phi$ 가 $R$ 의 미분 특성을 반영한다는 것을 알 수 있으므로, $SO(3)$ 원접 근처의 탄젠트 공간에 있다고 한다.

```math
\dot{R}(t) = \phi(t_0)^{\land}R(t) = \phi^{\land}_0R(t)
```

위의 방정식은 $R$ 에 대한 미분 방정식이며, 초깃값은 $R(0) = I$ 이므로 이 방정식에 대한 해는 아래와 같다.

```math
(\phi(t_0) = \phi_0) \\
R(t) = \exp(\phi^{\land}_0 t)
```

위의 식이 미분 방정식과 초깃값 모두에 대해 성립함을 확인할 수 있다. 즉, $t = 0$ 근처에서 회전 행렬은 $\exp(\phi^{\land}_0 t)$ 에 의해 계산될 수 있다. 회전 행렬 $R$은 지수 관계를 통해 행렬 $\phi^{\land}_0$ 라는 또 다른 skew-symmetric 행렬과 연관되어 있음을 알 수 있다. 그러나 행렬의 지수는 무엇인가

1. 특정 순간에 $R$ 이 주어지면 우리는 지역 미분 관계에서 $R$ 을 설명하는 $\phi$ 를 얻을 수 있다. $R$ 에 해당하는 $\phi$ 는 무엇을 의미할까? 우리는 $\phi$ 를 $SO(3)$ 에 해당하는 리 대수 $so(3)$ 라고 한다.

2. 벡터 $\phi$ 가 주어졌을 때 행렬 지수 $\exp(\phi^{\land}_0)$ 는 어떻게 계산될까? 반대로 $R$ 이 주어지면 $\phi$ 를 계산하는 반대 연산이 있을까? 이는 리 군과 리 대수 사이의 지수/로그 매핑이다.

### 1-3. 리 대수의 정의
각 리 군에는 그에 상응하는 리 대수가 있다. 리 대수는 리 군 원점 근처의 지역적 특성을 설명하며, 다른 말로는 탄젠트 공간이라고 한다. 일반적인 리 대수는 아래와 같이 정의된다.

> 리 대수는 집합 $\mathbb{V}$ , 스칼라 필드 $\mathbb{F}$ 와 이진 연산 $[,]$ 으로 구성된다. 다음 특성을 충족하는 경우 ($\mathbb{V}$ , $\mathbb{F}$ , $[,]$ )는 $\mathfrak{g}$ 로 표현되는 리 대수가 된다.
>
> 1. 폐쇄성: $\forall X, Y \in \mathbb{V}, [X, Y] \in \mathbb{V}$
>
> 2. 쌍선성: $\forall X, Y, Z \in \mathbb{V}, a, b, \in \mathbb{F}$
> 
>     $[aX + bY, Z] = a[X, Z] + b[Y, Z], [Z, aX + bY] = a[Z, X] + b[Z, Y]$
>
> 3. 자기 반발성: $\forall X \in \mathbb{V}, [X, X] = 0$
>
> 4. Jacobian 등가: $\forall X, Y, Z \in \mathbb{V}, [X, [Y, Z]] + [Z, [X, Y]] + [Y, [Z, X]] = 0$

이진 연산 $[,]$ 는 리 괄호라고 한다. 겉으로 보기에 리 괄호는 많은 속성을 필요로 한다. 군의 간단한 이진 연산에 비해 리 괄호는 두 요소 간의 차이를 나타낸다. 이는 결합법칙을 요구하지 않지만 대신 괄호 다음에 요소와 자신이 0이 되기를 요구한다.

### 1-4. 리 대수 $so(3)$
$\phi$ 는 리 대수이다. $SO(3)$ 에 해당하는 리 대수는 $\mathbb{R}^3$ 에 정의된 벡터이며, $\phi$ 의 이전 추론에 따르면 각 $\phi$ 의 skew-symmetric 행렬을 생성할 수 있다.

```math
\Phi = \phi^{\land} = \begin{bmatrix}0  & -\phi_3 & \phi_2 \\
\phi_3 & 0 & -\phi_1 \\
-\phi_2 & \phi_1 & 0 \end{bmatrix} \in \mathbb{R}^{3 \times 3}
```

이 정의에서 두 벡터 $\phi_1$ , $\phi_2$ 의 리 괄호는 아래와 같다.

```math
[\phi_1, \phi_2] = (\Phi_1 \Phi_2 - \Phi_2 \Phi_1)^\lor
```

벡터 $\phi$ 는 skew-symmetric 행렬에 일대일로 대응하기 때문에 $so(3)$ 의 요소는 3차원 벡터 또는 3차워 skew-symmetric 행렬이라고 모호성 없이 말할 수 있다.

```math
so(3) = \left\{ \phi \in \mathbb{R}^3, \Phi = \phi^{\land} \in \mathbb{R}^{3 \times 3} \right\}
```

$so(3)$의 의미를 명확히 해야한다. 이는 회전 행렬의 미분을 표현하는데 사용할 수 있는 3차원 벡터 또는 skew-symmetric 행렬의 모음이다. $SO(3)$ 와의 관계는 위에서 보았듯, 아래와 같은 지수 매핑에 의해 제공된다.

```math
R = \exp(\phi^{\land})
```

### 1-5. 리 대수 $se(3)$
$SE(3)$ 의 경우 또한 대응하는 리 대수 $se(3)$ 가 있다. $so(3)$ 와 마찬가지로 $se(3)$ 는 $\mathbb{R}^6$ 공간에 있다.

```math
se(3) = \left\{ \xi = \begin{bmatrix} \rho \\ \phi \end{bmatrix} \in \mathbb{R}^6, \rho \in \mathbb{R}^3, \phi \in so(3), \xi^{\land} = \begin{bmatrix} \phi^{\land} & \rho \\ 0^T & 0 \end{bmatrix} \in \mathbb{R}^{4 \times 4} \right\}
```

각 $se(3)$ 요소를 6차원 벡터 $\xi$ 로 표현한다. 처음 3개의 요소는 $\rho$ 로 표현되는 병진을 위한 것이며, 다음 3개 요소는 $\phi$ 로 표현되는 회전을 위한 것인데, 기본적으로 $so(3)$ 요소이다. $se(3)$ 에서는 $\land$ 기호를 사용하여 6차원 벡터를 4차원 행렬로 변환하며, 더 이상skew-symmetric 행렬만을 의미하지 않는다.

```math
\xi^{\land} = \begin{bmatrix} \phi^{\land} & \rho \\ 0^T & 0 \end{bmatrix} \in \mathbb{R}^{4 \times 4}
```

여전히 $\land$ 와 $\lor$ 기호를 사용하여 `벡터에서 행렬로` 와 `행렬에서 벡터로` 간의 관계를 표현하여 $so(3)$ 와의 일관성을 유지한다. 또한 이는 여전히 일대일 대응이다. 리 대수 $se(3)$ 에도 $so(3)$ 와 유사한 리 괄호가 있다.

```math
[\xi_1, \xi_2] = (\xi^{\land}_1 \xi^{\land}_2 - \xi^{\land}_2 \xi^{\land}_1)^{\lor}
```

## 02. 지수와 로그 매핑
### 2-1. $SO(3)$의 지수 매핑
$\exp(\phi^{\land})$ 룰 계산하는 방법을 알아본다. 이는 다른 말로 지수 매핑이라고 한다. 먼저 $so(3)$ 의 지수 매핑을 알아본다.

임의의 행렬 지수는 수렴된 경우, 테일러 급수를 사용해 확장하여 작성할 수 있으며, 그 결과도 여전히 행렬이고 아래와 같이 쓸 수 있다.

```math
\exp(A) = \sum_{n=0}^\infin \frac {1} {n!} A^n
```

$so(3)$ 의 모든 요소에 대해 $\phi$ 는 이러한 방식으로 지수 매핑을 정의할 수 있다.

```math
\exp(\phi^{\land}) = \sum_{n=0}^\infin \frac {1} {n!} (\phi^{\land})^n
```

아래는 지수 매핑을 계산하는 쉬운 방법이다. $\phi$ 가 3차원 벡터이므로 길이와 방향을 각각 $\theta$ 와 $n$ 으로 표현한다면 $\phi = \theta n$ 이다. $n$ 은 길이가 1인 단위 방향 벡터이다. 이와 같은 단위 방향 벡터 $n$ 에 대해 다음의 두가지 특성이 있다.

```math
a^{\land}a^{\land} = \begin{bmatrix} -a_2^2 - a_3^2 & a_1a_2 & a_1 a_3 \\ a_1 a_2 & -a_1^2 - a_3^2 & a_2 a_3 \\ a_1 a_3 & a_2 a_3 & -a_1^2 - a_2^2 \end{bmatrix} = aa^T - I
```

```math
a^{\land}a^{\land}a^{\land} = a^{\land}(aa^T - I) = -a^{\land}
```

이 두 식은  $n^{\land}$ 고차 항을 처리하는 방법을 제공하며 이를 이용해 지수 매핑을 아래와 같이 작성할 수 있다.

```math
\exp(\theta a^{\land}) = \cos \theta I + (1 - \cos \theta) a a^T + \sin \theta a^{\land}
```

이는 Chapter 03의 로드리게스 식과 같은 식이다. 이는 $so(3)$ 가 실제로 회전 벡터이며 지수 매핑은 로드리게스 수식임을 나타낸다. 이를 통해 $so(3)$ 의 모든 벡터를 $SO(3)$ 의 회전 행렬에 매핑할 수 있다. 반대로 로그 매핑의 경우 $SO(3)$ 의 요소를 $so(3)$ 에 매핑할 수도 있다.

```math
\phi = \ln(R)^{\lor} = \left( \sum_{n=0}^\infin \frac {(-1)^n} {n+1} (R - I)^{n+1} \right)^{\lor}
```

지수 매핑과 마찬가지로 로그 매핑으로 확정하려면 테일러 급수를 사용해야 한다.

지수 매핑을 계산하는 방법을 알아보자. 지수 매핑은 injective가 아닌 surjective일 뿐이다. 즉, 각 $SO(3)$ 의 요소는 이에 해당하는 $so(3)$ 요소를 찾을 수 있다는 의미이다. 하지만 동일한 $SO(3)$ 에 해당하는 여러 $so(3)$ 의 요소가 있을 수 있다. 회전 각도 $\theta$ 의 경우 360' 회전이 회전하지 않는 것과 동일하다. 그러나 회전 각도를 $\pm \pi$ 사이로 고정하면 리 군과 리 대수 요소는 일대일 대응이다.